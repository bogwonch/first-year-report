\ProvidesPackage{localstyle}

% If not using tufte, load a complete set of fonts
\@ifclassloaded{article}{\usepackage{lmodern}}
%\@ifclassloaded{report}{\usepackage{lmodern}}
%\@ifclassloaded{book}{\usepackage{lmodern}}

% Sane font sizing (larger / smaller)
\@ifpackageloaded{relsize}{}{\usepackage[]{relsize}}

\frenchspacing
\usepackage{url}
\@ifpackageloaded{natbib}{}{\usepackage[square,numbers]{natbib}}

% For floating packages and the wonderful H for really here figures
\@ifpackageloaded{float}{}{\usepackage[]{float}}

% For structuring the document
%\usepackage{subfiles}
\@ifpackageloaded{hyperref}{}{\usepackage[unicode=true]{hyperref}}

% For graphics
\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}
\graphicspath{{img/}}

% Acronyms
\usepackage{acronym}
\acrodef{AC}{assertion context}
\acrodef{ADB}{Android debug bridge}
\acrodef{AOSP}{Android Open Source Project}
\acrodef{IDS}{intrusion detection system}
\acrodef{BYOD}{bring your own device}
\acrodef{CWA}{closed world assumption}
\acrodef{EDB}{extensional database}
\acrodef{IDB}{intensional database}
\acrodef{OTA}{over the air}
\acrodef{OWA}{open world assumption}
\acrodef{PII}{personally identifiable information}
\acrodef{PUS}{potentially unwanted software}
\acrodef{RBAC}{role based access control}
\acrodef{RPC}{remote procedure call}
\acrodef{SLD}{selective linear definite clause}
\acrodef{LSM}{Linux security module} 
\acrodef{MAC}{Mandatory Access Control}
\acrodef{DAC}{Discretionary Access Control}
\acrodef{RBAC}{Role-Based Access Control}

\@ifundefined{marginfigure}{%
  \newcommand{\marginlength}{0.35\linewidth}
}{%
  \newcommand{\marginlength}{\linewidth}
}
%\newcommand{\marginlength}{\@ifundefined{marginfigure}{0.3\linewidth}{\linewidth}}

% Handle tufte figures gracefully
\@ifundefined{marginfigure}{%
  \newenvironment{marginfigure}{\begin{figure}\centering}{\end{figure}}
}{}
\@ifundefined{figure*}{%
  \newenvironment{figure*}{\begin{figure}\centering}{\end{figure}}
}{}

% Code
\@ifpackageloaded{xcolor}{}{\usepackage[usenames,dvipsnames]{xcolor}}
\usepackage{listings}
\lstset{%
  basicstyle=\tt,
  keywordstyle=\ttfamily\bfseries,
  columns=flexible,
  tabsize=2,
  showstringspaces=true,
  %numbers=left,
  numberstyle=\tiny\ttfamily\color{Gray},
  commentstyle=\ttfamily\color{Gray}
}
\newcommand{\code}[1]{\lstinline{#1}}
\newcommand{\secpal}[1]{\lstinline[language=SecPAL]{#1}}

\lstdefinelanguage{SecPAL}{%
  morecomment=[l]{//},
  mathescape=true,
  morekeywords={says,if,can,say,can,act,as,shows,assert,ask,meets,breaks,unsure,of},
  literate=* {\ inf}{{$_\infty$}}1 {can-say\ 0}{{can-say$_{\mathtt 0}$\ }}9 
}[keywords,comments,strings]

\lstdefinelanguage{PolicyMaker}{%
  morecomment=[l]{//},
  morekeywords={%
    policy,ASSERTS,WHERE,PREDICATE,regexp,pgp
  }
}[keywords,comments,strings]

\lstdefinelanguage{KeyNote}{%
  morecomment=[l]{//},
  morekeywords={%
  Authorizer,Licensees,KeyNote,Version,Local,Constants,%
  Conditions,app,domain,name,address%
  }
}
    
\lstdefinelanguage{BNF}{%
  morecomment=[l]{//},
  morekeywords={::=,|},
  mathescape=true
}

\lstdefinelanguage{Cassandra}{%
  morekeywords={%
    canActivate,hasActivated
  }
}

\lstdefinelanguage{Kirin}{%
  morekeywords={%
    restrict,and,permission,receive
  }
}

\lstdefinelanguage{selinux}{%
  morecomment=[l]{//},
  morekeywords={%
  allow,neverallow,getattr,read,write,set
  }
}

\lstdefinelanguage{grsec}{%
  morekeywords={%
  role,subject
  }
}

% Maths
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{proof}

% Gantt Charts
\usepackage{pgfgantt}
\usepackage{pdflscape}
\@ifpackageloaded{geometry}{}{\usepackage[a4paper]{geometry}}

%% Spacing
%%\geometry{verbose,tmargin=5cm,bmargin=3cm,lmargin=3cm,rmargin=3cm}
%\setlength{\parskip}{2\smallskipamount}
%\setlength{\parindent}{2em}
%\usepackage{setspace}
%\setstretch{1.2}

%
%\usepackage[nottoc,numbib]{tocbibind}

% Diagrams
\usepackage{tikz}
\usetikzlibrary{shapes,arrows}
\usepackage{dot2texi}

% Algorithms
\usepackage{algorithm2e}
\DontPrintSemicolon
\SetKwComment{tcc}{\# }{}
\SetKwProg{Fn}{}{\string:}{}
\SetKwProg{Block}{}{}{}
\SetKwFor{For}{for}{\string:}{}
\SetKwFor{ForAny}{$\exists$}{\string:}{}
\SetKwFor{ForAll}{$\forall$}{\string:}{}
\SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
\SetKwSwitch{Match}{With}{Other}{match}{\string:}{with}{otherwise}{}{}
\SetKwSwitch{Switch}{Case}{Other}{switch}{\string:}{case}{otherwise}{}{}
\SetKwIF{If}{ElseIf}{Else}{if}{\string:}{else if}{else}{}
\SetKwFor{Where}{where}{\string:}{}

% Nicely typeset tables
\usepackage{booktabs}

\newcommand{\sideways}[1]{%
  \parbox[t]{2mm}{\rotatebox[origin=c]{270}{#1}}
}

% Ticks
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\tick}{\ding{51}}
\newcommand{\cross}{\ding{55}}


% Quotation fonts
%\usepackage{etoolbox}
%\usepackage{fontspec}
%\newfontfamily\quotefont{Latin Modern Sans Quotation}
%\AtBeginEnvironment{quote}{\quotefont\smaller}

